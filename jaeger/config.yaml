service:
    extensions: [ jaeger_storage, jaeger_query, healthcheckv2 ]
    pipelines:
        traces:
            receivers: [ otlp ]
            processors: [ batch ]
            exporters: [ jaeger_storage_exporter ]
    telemetry:
        resource:
            service.name: jaeger
        metrics:
            level: detailed
            readers:
                -   pull:
                        exporter:
                            prometheus:
                                host: 0.0.0.0
                                port: 8888
        logs:
            level: debug
            
extensions:
    healthcheckv2:
        use_v2: true
        http:
        
    jaeger_query:
        storage:
            traces: elasticsearch_storage
            metrics: some_metrics_storage
            traces_archive: elasticsearch_storage_archive
        max_clock_skew_adjust: 0s
            
    jaeger_storage:
        backends:
            elasticsearch_storage: &elasticsearch_config
                elasticsearch:
                    server_urls:
                        - http://elastic-search:9200
                    auth:
                        basic:
                            username: "${env:ELASTIC_USERNAME}"
                            password: "${env:ELASTIC_PASSWORD}"
                    indices:
                        index_prefix: "jaeger-main"
                        spans:
                            date_layout: "2006-01-02"
                            rollover_frequency: "day"
                            shards: 5
                            replicas: 1
                        services:
                            date_layout: "2006-01-02"
                            rollover_frequency: "day"
                            shards: 5
                            replicas: 1
                        dependencies:
                            date_layout: "2006-01-02"
                            rollover_frequency: "day"
                            shards: 5
                            replicas: 1
                        sampling:
                            date_layout: "2006-01-02"
                            rollover_frequency: "day"
                            shards: 5
                            replicas: 1
            elasticsearch_storage_archive:
                elasticsearch:
                    server_urls:
                        - http://elastic-search:9200
                    auth:
                        basic:
                            username: "${env:ELASTIC_USERNAME}"
                            password: "${env:ELASTIC_PASSWORD}"
                    indices:
                        index_prefix: "jaeger-archive"
        metric_backends:
            some_metrics_storage:
                prometheus:
                    endpoint: http://prometheus:9090
                    normalize_calls: true
                    normalize_duration: true
                    
    remote_sampling:
        adaptive:
            sampling_store: some_store
            initial_sampling_probability: 0.1
        http:
        grpc:

receivers:
    otlp:
        protocols:
            grpc:
            http:
                endpoint: "0.0.0.0:4318"

processors:
    batch:

exporters:
    jaeger_storage_exporter:
        trace_storage: elasticsearch_storage